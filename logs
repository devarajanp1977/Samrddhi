#!/bin/bash

echo "üìú Viewing Samrddhi Logs..."

# Function to show available log files
show_log_files() {
    echo "üìÅ Available log files:"
    find logs/ -name "*.log" -type f 2>/dev/null | while read -r logfile; do
        size=$(du -h "$logfile" | cut -f1)
        echo "   $logfile ($size)"
    done
}

# Function to tail multiple logs
tail_logs() {
    local log_files=()
    
    # Collect available log files
    if [ -f "logs/system/samrddhi.log" ]; then
        log_files+=("logs/system/samrddhi.log")
    fi
    
    if [ -f "logs/trading/trading.log" ]; then
        log_files+=("logs/trading/trading.log")
    fi
    
    # Add service-specific logs
    for service_log in logs/services/*.log; do
        if [ -f "$service_log" ]; then
            log_files+=("$service_log")
        fi
    done
    
    if [ ${#log_files[@]} -eq 0 ]; then
        echo "‚ùå No log files found. Start a service first."
        exit 1
    fi
    
    echo "üëÄ Tailing logs from ${#log_files[@]} files..."
    echo "   (Press Ctrl+C to stop)"
    echo ""
    
    # Use multitail if available, otherwise use tail
    if command -v multitail &> /dev/null; then
        multitail "${log_files[@]}"
    else
        tail -f "${log_files[@]}"
    fi
}

# Check command line arguments
case "${1:-}" in
    "system")
        echo "üìä System logs:"
        if [ -f "logs/system/samrddhi.log" ]; then
            tail -f logs/system/samrddhi.log
        else
            echo "‚ùå System log not found"
        fi
        ;;
    "trading")
        echo "üí∞ Trading logs:"
        if [ -f "logs/trading/trading.log" ]; then
            tail -f logs/trading/trading.log
        else
            echo "‚ùå Trading log not found"
        fi
        ;;
    "audit")
        echo "üîç Audit logs:"
        if [ -f "logs/audit/audit.log" ]; then
            tail -f logs/audit/audit.log
        else
            echo "‚ùå Audit log not found"
        fi
        ;;
    "services")
        echo "üîß Service logs:"
        if ls logs/services/*.log 1> /dev/null 2>&1; then
            tail -f logs/services/*.log
        else
            echo "‚ùå No service logs found"
        fi
        ;;
    "list")
        show_log_files
        ;;
    "help"|"-h"|"--help")
        echo "üìñ Usage: $0 [option]"
        echo ""
        echo "Options:"
        echo "  system    - Show system logs only"
        echo "  trading   - Show trading logs only"
        echo "  audit     - Show audit logs only"
        echo "  services  - Show all service logs"
        echo "  list      - List all available log files"
        echo "  help      - Show this help message"
        echo ""
        echo "No option: Show all logs (default)"
        ;;
    *)
        # Default: show all logs
        show_log_files
        echo ""
        tail_logs
        ;;
esac
